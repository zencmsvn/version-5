function nl2br (str, is_xhtml) {

  var breakTag = (is_xhtml || typeof is_xhtml === 'undefined') ? '<br ' + '/>' : '<br>'; // Adjust comment to avoid issue on phpjs.org display

  return (str + '').replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g, '$1' + breakTag + '$2');
}
tinymce.PluginManager.add("quote", function (e) {
    function t() {
        var text = e.selection.getContent({format: 'text'});
        if (text == null || text == 'undefined' || text == '') {
            text = "\n";
        }
        e.insertContent("<div class=\"quoteStyle\">" + nl2br(text) + "&nbsp;</div>\n&nbsp;");
    }
    e.addButton("quote", {icon: "quote", tooltip: "Thêm đoạn trích", onclick: t});
});